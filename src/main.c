#define SAVE_SCREEN
#include <tigcclib.h>
#include "menu.h"

short _ti89,_ti92plus;


// number of tiles in array data
#define TILENUMBER_DATA 15

// height of one tile in array data
#define TILEHEIGHT_DATA 32

// macro returns the address of tile nr of plane p from array data
#define TILEADDR_DATA(p,nr) &(data[p][TILEHEIGHT_DATA*nr])

unsigned long data[2][TILENUMBER_DATA*TILEHEIGHT_DATA] = {{
// tile 0
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
// tile 1
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
// tile 2
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
// tile 3
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
// tile 4
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
// tile 5
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xfffffff1,0xfffffd00,0xfffffc03,0xfffff000,0xffffc000,0xfdffc000,0xe03f0001,0xa01c0302,
// tile 6
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xfffffffc,0xfffffe7f,0xfffef041,0xfffde01c,
0xfffdc01c,0xffff801b,0xffff0007,0xfffe000f,0xfff80402,0xfff00000,0xffe00001,0xffc00007,
0xffc0001f,0xff80007f,0xff8000c1,0xff800000,0xff000000,0xff000013,0xff000077,0xff003ff7,
0xbf81fff5,0x139ffffc,0x06ffffe0,0x0effcff9,0x1effcff0,0x3effe7f0,0x7fffffff,0xe7fffdff,
// tile 7
0xffffffff,0xffffffff,0xffffffff,0x3fffffff,0x0fffffff,0x87ffffff,0xc7ffffff,0xffffffe8,
0x3ffde000,0xbafc0000,0xffe00000,0xfffffff0,0x7ffffc00,0x7fffe000,0xfffffff8,0xffffffff,
0xffffffff,0xfffffff0,0xffffffc0,0x00001fff,0x27feffff,0x8ffbfff7,0xdfcff0cf,0x3f39fc70,
0x823f0038,0x03ff020c,0x03ffdc86,0x07ffc703,0x07ff81c1,0x0fff00e0,0x1fff8660,0xffff8fb0,
// tile 8
0xfffffffe,0xffffffff,0xffffffff,0xffffffcc,0xffffc002,0xffe00003,0xe8000001,0x00000000,
0x00000000,0x00000000,0x00000000,0x00000020,0x00000010,0x00000008,0x00000008,0xfc00000c,
0xf800000c,0x0080000c,0x0780000f,0xff00000f,0xfe00000f,0xf600000f,0x8400000f,0x0c00000f,
0x1c00001f,0x1c00001f,0x3c10005f,0x3c30007f,0x3e7800ff,0x7ef801ff,0x5efc01ff,0xfffc03ff,
// tile 9
0x7fffffff,0xbcffffff,0xf01fffff,0x7f07ffff,0x0ff1ffff,0x83fc7fff,0xe0ffbfff,0xfc7fffff,
0x3f9fffff,0x1fe7ffff,0x0ffbffff,0x07fdffff,0x0fffffff,0x07ffffff,0x07ffffcf,0x03ffff70,
0x03fffd80,0x01ffe66c,0x01ffdb34,0x81ffd77f,0xc1fffcec,0xc1ffe8c0,0xe1ffeff3,0xf1fff000,
0xf9fff001,0xf9fff006,0xfdfff01b,0xfdfff84e,0xffff833f,0xfffe08fe,0xfff863ff,0xffe09fff,
// tile 10
0x4004201b,0x8001a004,0x00008010,0x8000c060,0x00000008,0x00001200,0x00000430,0x00000016,
0x00000018,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x043cbc04,
0x804e0028,0x00110000,0x000c000f,0x80100008,0xe0300020,0xf0600060,0x00000000,0xf8000100,
0x00000000,0x00002818,0x0008c601,0x004107e0,0x02101000,0x1680a300,0xb4078000,0xf0000000,
// tile 11
0xc5fffcff,0x0dfffe7f,0x19ffff3f,0x15ffffdf,0x43ffffef,0x8bfffff3,0x13fffff9,0x07fffffc,
0x07fffffe,0x078fffff,0x0e57ffff,0x0823ffff,0x0001ffff,0x50c2ffff,0x01c17fff,0x03100000,
0x08004000,0x02000400,0xc0000001,0x0000000e,0x00000014,0x01860040,0x05fd0180,0x37ff4400,
0xbfffe400,0x00000000,0xf0008007,0x1019001f,0x00480064,0x00064180,0x00000207,0x0000186c,
// tile 12
0xffffdff0,0xfffffff8,0xffe1eff8,0xfff877ec,0xfffc7bdc,0xfffc3c1c,0xfffd1f04,0xffff1fbc,
0x3fff8f1c,0x3fffc787,0xffffcf82,0xffffe784,0xfffff780,0xff800000,0xf0102000,0x01200108,
0x01000008,0x0800000c,0x80000030,0x00000040,0x00000100,0x00000c00,0x00218800,0x033cc000,
0x3fe200e0,0xfe080200,0x70101500,0x8040dc00,0x09027800,0x440bd000,0x002fc000,0x01be801f,
// tile 13
0xbfff03ff,0x3fff07ff,0x3fff07ff,0x3fff0ffc,0x7fff9ff8,0x7fff9fe0,0x7bffbf02,0xf7fffe08,
0xc7fffc08,0x87ffe020,0x0fff8100,0x0ffe0100,0x1c000000,0x10000000,0x00000000,0x00000000,
0x00000000,0x00000001,0x00000000,0x00000000,0x00000001,0x00000000,0x00000000,0x00000000,
0x00000000,0x00000010,0x00000040,0x00000040,0x00000700,0x00001f00,0x00003e00,0xc0007e00,
// tile 14
0xfa817ffb,0xc083ffff,0x840bffff,0x1807fff6,0x0017ff88,0x400fff90,0x001fff40,0x003fff80,
0x007ffe00,0x00fffc00,0x01fff800,0x03ffe000,0x07ffc000,0x2fff0000,0x1ffc0000,0x3ff00000,
0x3fc00000,0x7f000000,0xfc000000,0xe0000000,0x00000000,0x00000000,0x00000000,0x00000000,
0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000
},
// ---- plane 2 ----
{
// tile 0
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
// tile 1
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
// tile 2
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
// tile 3
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
// tile 4
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
// tile 5
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xfffffffe,0xfffffe00,0xfffff800,0xfffff000,0xffffe000,0xfeff8000,0xfc7f0000,0xd81e0001,
// tile 6
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffe3,
0xffffffe3,0xffffffe7,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffec,0xffffff8f,0xffffc00f,
0x7f7e000e,0xff60000f,0x1f00001f,0x3f003007,0x3f00300f,0x7f00180f,0xfe000000,0xfe000200,
// tile 7
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xd801ffff,0x7007ffff,0xe03fffff,0xc0fe03ff,
0x7dc0ffff,0xfc00ffff,0xfc003fff,0xf8000fff,0xf80003ff,0xf00083ff,0xe000467f,0x00004fff,
// tile 8
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
// tile 9
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xfffffff0,0xffffff8f,
0xfffffe7f,0xfffff993,0xffffe4cb,0xffffe880,0xffffe313,0xfffff73f,0xfffff00c,0xffffffff,
0xffffffff,0xffffffff,0xfffffffc,0xfffffff1,0xffffe7c0,0xffff4701,0xfffc9c00,0xfff1e000,
// tile 10
0xb00c1fe7,0x6002400e,0xc0010018,0x00000030,0x00002007,0x00000c00,0x000003c0,0x00000060,
0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000000,0x00000001,0x03c04002,
0x7ff18000,0xfffe0000,0xfffc0000,0x7ff80010,0x1fe00000,0x0fc00000,0xff800040,0x00000080,
0x00000100,0x00001607,0x0007fdff,0x003e081e,0x01e03ff8,0x09007c00,0x48000000,0x00000000,
// tile 11
0x8e000300,0x0e000180,0x0e0000c0,0x02000020,0x84000010,0x7400000c,0x0c000006,0x08000003,
0x08000001,0x18700000,0x11880000,0x17040000,0x3c620000,0x20210000,0x80208000,0x00e0ffff,
0x07803fff,0x3c0003ff,0x0000003f,0x00000007,0x00000008,0x00780020,0x02020000,0x08008200,
0x40001800,0xfffff000,0xffffc000,0x0fe60000,0x003c0000,0x00018000,0x00000400,0x00000013,
// tile 12
0x00003fff,0x00001fff,0x001e1fff,0x00078dff,0x0003858f,0x0003c20f,0x0003e00f,0x0000e07f,
0xc00070ff,0xc000387f,0x0000307f,0x0000187f,0x0000087f,0x007fffff,0x0ffc1fff,0xffc000ff,
0xfe000006,0xf0000000,0xc0000000,0x00000000,0x00000000,0x00000000,0x00007000,0x00c00000,
0x00010000,0x00040180,0x00200a00,0x01802000,0x06018000,0x38042000,0xe0100000,0x80410000,
// tile 13
0xffffffff,0xffffffff,0xffffffff,0xfffffffc,0xfffffff0,0xffffffc0,0xffffff81,0xfffffe04,
0xfffff810,0xfffff040,0xffffc080,0xffff0000,0xf8000000,0xe0000000,0x80000000,0x00000000,
0x00000000,0x00000000,0x00000001,0x00000003,0x00000002,0x00000007,0x00000007,0x0000000f,
0x0000001f,0x0000001f,0x0000003f,0x000000ff,0x000003ff,0x00000fff,0x00003fff,0x00007fff,
// tile 14
0xfc438004,0xe1060000,0x02040000,0x00080009,0x20180077,0x8030006f,0x006000bf,0x00c0007f,
0x018001ff,0x030003ff,0x060007ff,0x0c001fff,0x18003fff,0x1000ffff,0x2003ffff,0x400fffff,
0xc03fffff,0x80ffffff,0x03ffffff,0x1fffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,
0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff,0xffffffff
}};


void _main(void) {
    /* old school program code lifted from tttiler */
    short x,y;
    short tilewidth  = 32;
    short vcount     = 3;
    short hcount     = 5;
    short i;
    if (!GrayOn()) return;
    memset(GetPlane(0),0,LCD_SIZE);
    memset(GetPlane(1),0,LCD_SIZE);
    for (y = 0; y < vcount; y++) {
      for (x=0;x < hcount; x++) { 
        short nr = y * hcount + x;
        for (i = 0; i < 2; i++) {
            Sprite32(x*tilewidth,y*TILEHEIGHT_DATA,TILEHEIGHT_DATA,TILEADDR_DATA(i,nr),GetPlane(i),SPRT_OR);
        }
      }
    }

    border_pattern_t TEST_BORDER = (border_pattern_t) {
      .pattern.split.pattern_h = {0xF0,0x00,0x00,0xF0, 0x00, 0x00, 0x00, 0x00},
      .pattern.split.pattern_v = {0x90,0x90,0x90,0x90, 0x00, 0x00, 0x00, 0x00},
      .corners.split.corners_bl= {0xA0,0xB0,0x80,0xF0, 0x00, 0x00, 0x00, 0x00},
      .corners.split.corners_tr= {0xF0,0x10,0xD0,0x50, 0x00, 0x00, 0x00, 0x00},
      .corners.split.corners_tl= {0xF0,0x80,0xB0,0xA0, 0x00, 0x00, 0x00, 0x00},
      .corners.split.corners_br= {0x50,0xD0,0x10,0xF0, 0x00, 0x00, 0x00, 0x00},
      .width = 4,
      .height = 4
    };
    DrawMenuBorder(&TEST_BORDER, 0, 76, 160-4, 20);
    
    FontSetSys (F_4x6);
    // greyscale requires you to work with multiple planes.
    // so black text requires setting both planes!
    for(uint8_t i = 0; i <= 1; i++) {
      SetPlane(i);
      DrawStr (4+2, 76+4+2+6, "Maybe I was born, so that I would meet you.", A_NORMAL);
      // x: border + padding, y: 76 + border + padding
    }

    SetPlane(DARK_PLANE);
    DrawStr (4+2, 76+4+2, "Kaworu", A_NORMAL);
   
    ngetchx();
    GrayOff();
}

